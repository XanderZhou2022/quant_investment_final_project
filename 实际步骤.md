# 第一部分：研究动机与因子轮动的理论背景

本研究的核心目标是构建并验证一套基于机器学习的因子轮动（Factor Rotation）策略，以探索在中国股票市场中，不同风格因子随市场环境变化而动态配置的可行性与有效性。传统多因子投资框架通常假设各类因子在长期内能够持续提供稳定的风险溢价，因此常采用静态或准静态的因子权重配置方式。然而，近年来大量理论与实证研究表明，这一假设在实际市场中往往难以成立：因子收益并非时间不变，而是呈现出明显的阶段性、周期性与结构性变化。

从经济直觉上看，不同因子所代表的风险补偿机制在不同市场环境中发挥作用的程度并不一致。例如，动量因子依赖于趋势延续，其有效性通常建立在市场存在明确方向性和投资者行为惯性的前提之上；价值因子更多反映对基本面均值回归的押注，在市场情绪悲观或风险溢价上升阶段往往具有相对防御属性；质量因子强调盈利能力和经营稳健性，在震荡或不确定性较高的环境中更容易获得风险调整后的超额收益；而低波动与规模等因子，则常与风险厌恶程度和资金结构变化密切相关。因此，单一或静态的因子配置方式，可能在特定阶段表现良好，却在其他阶段显著失效。

上述现象构成了因子轮动理论的核心思想：因子溢价具有显著的时间变化特征，其表现与市场所处的宏观状态密切相关。如果能够在一定程度上刻画当前市场环境，并基于历史信息预测下一阶段不同因子的相对表现强弱，就有可能通过动态调整因子权重，在保持风险可控的前提下提升整体投资组合的收益质量。

然而，因子轮动策略在实际应用中面临两个关键挑战。第一，市场状态本身并非直接可观测，其划分具有较强的主观性，如何基于数据对市场环境进行客观、可重复的识别，是因子轮动策略成立的前提。第二，即使确认了因子收益的状态依赖性，因子表现的变化往往具有较强的时序相关性与噪声特征，简单的规则或静态判断难以有效捕捉其动态演化过程。

基于此，本研究引入数据驱动的方法，尝试将因子轮动问题拆解为两个相互关联但逻辑清晰的子问题：一是通过指数层面的市场特征识别不同的市场状态，从实证角度验证因子收益的状态依赖性是否存在；二是利用机器学习模型对因子收益的时间序列结构进行建模，预测下一期各因子的相对表现，并据此生成动态因子权重。在这一框架下，市场状态信息并非直接用于交易决策，而是作为刻画因子收益环境的重要辅助变量，帮助模型更好地理解因子轮动的内在机制。

在研究对象的选择上，本研究以上证50指数成分股作为股票池，兼顾样本稳定性与市场代表性；在研究目标上，重点关注动态因子配置在样本外测试阶段是否能够相较于静态多因子策略实现更优的风险调整后表现。通过因子构建、市场状态识别、机器学习预测与回测评估的完整流程，本研究旨在系统性地检验因子轮动策略在中国市场背景下的可行性，并为数据驱动的多因子投资提供一套可复现、可扩展的研究范式。



# 第二部分：数据来源与预处理

本研究所使用的数据主要分为两类：一类为因子层面的收益数据，用于刻画不同风格因子的时间序列表现；另一类为指数层面的市场特征数据，用于识别市场状态（Regime）。两类数据在时间维度上均采用月度频率，并在后续分析中严格对齐。

## 2.1 因子数据来源与因子选择依据

因子层面数据基于上证50指数成分股的横截面选股因子构建。上证50指数覆盖中国A股市场中规模大、流动性强、信息披露相对完善的蓝筹公司，能够在一定程度上降低小市值股票带来的流动性噪声与交易约束问题，因此常被用于多因子研究与机构投资策略分析。

在因子选择方面，本研究并未追求大规模“因子动物园”，而是聚焦于文献中最为经典、经济含义清晰、且在不同市场中反复被验证过有效的几类核心风格因子，具体包括动量、价值、质量与风险相关因子。这种设计有助于避免高维因子带来的过拟合风险，同时提升研究结果的可解释性与可复现性。

动量类因子（Momentum）：包括短期动量（MOM20）、中期动量（MOM120）与技术指标 RSI。动量因子是最早被系统性验证的横截面异象之一，Jegadeesh and Titman（1993）指出，股票过去收益对未来收益具有显著的预测能力，其背后可能反映了投资者行为偏差与信息扩散不充分等机制。后续研究表明，动量因子对市场趋势状态高度敏感，是因子轮动研究中的核心对象。

价值类因子（Value）：包括市净率倒数（PB⁻¹）、市盈率倒数（PE⁻¹）以及股息率（DIV）。Fama and French（1992, 1993）提出的三因子模型表明，价值因子长期提供显著的风险溢价，其表现通常在市场回撤或风险厌恶上升阶段更为稳健，因此在因子轮动框架中常被视为防御性因子。

质量类因子（Quality）：包括净资产收益率（ROE）与利润增长率。Novy-Marx（2013）指出，高盈利能力股票在控制其他因子后仍能获得显著超额收益。质量因子往往代表企业基本面的稳健程度，其收益表现与宏观不确定性和市场情绪密切相关。

风险相关因子（Risk-related Factors）：包括历史波动率（VOL）与市场 Beta。Ang et al.（2006）等研究发现，低波动股票在长期内往往获得更高的风险调整后收益。风险因子在因子轮动中通常体现为“风险暴露管理”的工具，其权重变化反映了投资组合对系统性风险的态度调整。

上述因子均基于天软金融工程平台提供的函数接口进行计算，并在每个月末对上证50成分股进行横截面因子值计算与排序。

## 2.2 多空因子收益的构建方法

为了将横截面因子信号转化为可用于时间序列建模的因子收益，本研究采用标准的分组法构建因子多空组合收益。具体而言，在每一个月度调仓日，对上证50成分股按照某一因子的取值进行排序，并等分为五组（五分位组合）。其中，第1组对应因子值最低的股票组合，第5组对应因子值最高的股票组合。

因子当期的**多空收益（Long–Short Return）**定义为第5组组合的平均收益减去第1组组合的平均收益，即：

因子多空收益 = 高因子暴露组收益 − 低因子暴露组收益

这种构造方式在因子研究中被广泛采用，其优势在于能够在较大程度上剥离市场整体涨跌的影响，更直接地反映因子本身所带来的横截面收益差异。因此，多空收益序列被视为因子是否存在风险溢价、以及因子强弱随时间变化的重要度量。本研究最终得到的各因子多空收益时间序列被汇总为 factor_longshort.csv 文件，作为后续机器学习模型与轮动分析的核心输入数据。

## 2.3 市场状态数据与特征构建

市场状态识别所使用的数据来自上证50指数本身，旨在从指数层面刻画整体市场环境，而非个股层面的微观特征。具体选取的特征包括：月度指数收益率、20日与60日年化波动率、月度成交量总和以及成交量变化率。这些指标分别从收益水平、风险波动与交易活跃度三个维度反映市场的风险偏好与不确定性状况，在既有研究中常被用于市场状态刻画与风险周期分析。

所有指数特征在进入模型前均进行了标准化处理，以消除量纲差异对聚类结果的影响。

## 2.4 市场状态的聚类方法说明

在市场状态识别阶段，本研究采用无监督学习方法对指数特征进行聚类分析。具体而言，使用 KMeans 算法对标准化后的市场特征向量进行聚类。KMeans 的优势在于其实现简单、结果直观，且在金融时间序列的状态划分中被广泛应用。

聚类数的选择并非事先人为设定，而是通过计算不同聚类数下的 Silhouette Score 进行评估，从而在类内相似度与类间差异度之间取得平衡。综合考虑模型稳定性与经济解释性后，本研究最终选择将市场划分为三个 Regime，分别对应于趋势上行状态、高波动下行状态以及低波动震荡状态。聚类结果按月生成市场状态标签，并整理为 cluster_info 数据文件。

## 2.5 时间对齐与数据一致性处理

为确保因子收益数据与市场状态数据在时间维度上的严格一致性，所有日期均统一转换为对应月份的第一天作为时间索引。这一处理方式保证了在任意一个月度调仓点，模型所使用的信息均来源于该期及之前已经可观测的数据，有助于避免时间错配或潜在的数据穿越问题。


# 第三部分：因子轮动理论的验证逻辑

为了验证因子轮动策略在实证层面的可行性，本研究在引入任何机器学习模型之前，首先基于数据对因子收益的“状态依赖性”进行验证。因子轮动策略成立的前提并非模型的预测能力，而是客观存在的经济现象：即不同因子在不同市场环境下，其收益表现存在系统性差异。因此，本部分重点回答两个问题：（1）市场状态是否能够通过指数层面的可观测特征被有效识别；（2）在这些市场状态下，因子多空收益是否呈现出显著不同的统计特征。

## 3.1 基于指数特征的市场 Regime 识别结果

本研究基于上证50指数构建市场状态识别所需的特征向量，具体包括月度指数收益率（ret_month）、20日年化波动率（vol_20_annual_month_end）以及月度成交量总和（vol_month_sum）。上述特征分别从收益水平、风险强度与交易活跃度三个维度刻画整体市场环境。所有特征在进入模型前均进行了标准化处理。

在方法上，采用 KMeans 无监督聚类对月度市场特征进行状态划分。通过对不同聚类数下的 Silhouette Score 进行比较，发现当聚类数为 3 时，模型在类内相似性与类间区分度之间取得最优平衡，因此最终将样本期内的市场划分为三个 Regime，分别记为 Regime 0、Regime 1 和 Regime 2。

基于聚类结果，对各 Regime 下的指数特征进行统计分析后可以发现，三类市场状态在收益与风险维度上具有清晰且稳定的区分特征：

Regime 0：该状态下指数月度收益均值为正，20日年化波动率处于样本期内的较低水平，同时成交量保持相对温和，整体反映出趋势较为平稳、风险偏好较高的市场环境。

Regime 1：该状态对应的指数月度收益显著偏低，部分月份出现明显负收益，同时波动率水平显著高于其他状态，成交量波动较大，反映出市场风险集中释放或情绪剧烈波动的阶段。

Regime 2：该状态下指数月度收益接近零或小幅波动，波动率处于中等水平，但成交量维持在较高区间，表现为方向性不强但交易活跃的震荡型市场环境。

上述结果表明，基于指数层面特征的聚类方法并非对市场进行任意划分，而是能够识别出在收益、风险与交易行为层面具有显著差异的市场状态。这为后续因子收益的状态依赖性分析提供了基础。

## 3.2 不同 Regime 下因子多空收益的差异化表现

在确认市场 Regime 具有明确经济含义之后，本研究将聚类得到的 Regime 标签与因子多空收益时间序列进行合并，系统性地比较不同市场状态下各类因子的表现差异。具体而言，将 factor_longshort.csv 与 cluster_info 按月对齐，得到包含因子多空收益及对应 Regime 的联合样本。

统计结果显示，不同因子在 Regime 0、Regime 1 与 Regime 2 下的平均多空收益与波动水平存在显著差异，且这种差异具有一致的经济解释：

在 Regime 0（正收益、低波动） 下，动量类因子（如 MOM20、MOM120、RSI）整体表现较为突出，多空收益均值明显高于其他状态，反映出趋势延续型因子在市场方向性明确阶段的有效性。

在 Regime 1（低收益、高波动） 下，动量因子的表现显著弱化甚至出现回撤，而价值类因子（PB⁻¹、PE⁻¹）以及风险因子（低波动、低 Beta）相对更具防御属性，其多空收益分布更为稳定。

在 Regime 2（震荡、高成交） 下，质量类因子（ROE、利润增长率）表现相对稳健，尽管整体收益水平有限，但在风险调整后具备一定优势。

上述结果表明，因子收益并非在时间维度上稳定不变，而是对市场所处的 Regime 高度敏感。这种状态依赖性为因子轮动策略提供了直接的实证依据。

## 3.3 因子轮动的实证结论与研究设计含义

通过市场状态识别与因子收益分布分析，本研究在不依赖任何预测模型的前提下，验证了因子轮动现象在样本期内的客观存在性。一方面，市场状态能够通过指数特征被有效划分，并在时间序列上呈现出一定的持续性；另一方面，不同因子在不同 Regime 下的表现具有系统性差异，而非随机波动。

因此，静态因子配置方法难以在所有市场环境中保持最优，而基于历史信息动态调整因子权重在理论与实证层面均具备合理性。基于这一结论，后续研究将进一步引入机器学习模型，对因子收益的时间序列结构进行建模，并尝试在样本外预测下一期因子表现，从而构建可执行的动态因子轮动策略。


# 第四部分：模型训练数据集的构建与样本划分

在完成因子多空收益与市场状态（Regime）标签的合并之后，本研究构建了用于机器学习建模的最终数据集 final_factor_longshort.csv。该数据表以月度为频率，包含每个月各因子的多空收益以及对应的市场 Regime 标签，是后续模型训练、验证与预测的唯一中心数据源。

## 4.1 数据来源与时间范围

final_factor_longshort.csv 的构建基于以下两个数据文件：

因子多空收益数据（factor_longshort.csv）
该数据由天软平台计算得到，基于上证50指数成分股，在每个月末对各因子进行横截面排序、五分位分组，并计算高分组减低分组（G5−G1）的多空收益，得到月度因子收益时间序列。

市场状态数据（cluster_info）
该数据基于上证50指数的月度特征（收益、波动率、成交量等）通过 KMeans 聚类得到，为每个月分配一个市场 Regime 标签。

在数据处理阶段，上述两类数据按照月份进行严格对齐，并统一将日期转换为对应月份的第一天作为时间索引，以避免不同数据源在月末交易日上的错配问题。合并后形成 final_factor_longshort.csv，其时间范围覆盖 2015-01-01 至 2024-12-01，共包含完整的连续月度观测。

## 4.2 模型输入与输出的构造方式

为了构造适用于时间序列预测模型的输入样本，本研究采用滑动窗口（rolling window）方法。具体而言，在任意预测时点 t，模型的输入仅使用 t 之前连续 12 个月 的历史信息，包括：

各因子的月度多空收益；

对应月份的市场 Regime 信息（以 one-hot 编码形式表示）。

模型的输出为 t 时点对应的各因子多空收益，即下一期因子收益的预测值。这一设计确保模型在任何时点的预测均仅基于当时可获得的历史信息，符合真实投资场景下的信息约束。

在实现过程中，Regime 标签首先被转换为 one-hot 向量，并与因子收益序列在时间维度上拼接，作为模型的联合输入特征。这使得模型能够在学习因子自身时间依赖结构的同时，显式利用市场状态信息刻画不同环境下的因子表现差异。

## 4.3 样本划分与时间顺序约束

在样本划分方面，本研究严格按照时间顺序对数据进行切分，而非随机划分，以避免潜在的数据泄漏问题。具体划分方式如下：

训练集（70%）：样本期最早的 70% 月度数据，用于模型参数的学习；

验证集（20%）：紧接其后的 20% 数据，用于模型结构选择与超参数调优；

测试集（10%）：样本期末的 10% 数据，仅用于样本外预测与策略回测评估。

在具体时间维度上，测试集对应的区间为 2024-02-01 至 2024-12-01。这一时间段内，模型参数已经在此前的训练集与验证集上完全确定，测试集数据不参与任何形式的模型训练或调参过程，仅用于生成因子收益预测与动态权重。

## 4.4 数据穿越风险的控制说明

需要特别强调的是，本研究在数据构建与模型训练过程中不存在数据穿越或前视偏差。原因主要体现在以下几个方面：

第一，在特征构造层面，所有因子多空收益与市场 Regime 标签均基于当期及之前可观测的数据计算，不使用任何未来信息。

第二，在样本划分层面，训练集、验证集与测试集严格按照时间顺序划分，模型在预测测试集期间不再进行参数更新。

第三，在预测与回测衔接层面，模型在测试集每一个月 t 所生成的因子收益预测，仅基于 t−1 及之前 12 个月的数据，并据此生成当期因子权重，再用于 t 当期的策略配置。这一流程与真实投资决策中的“先预测、再配置”顺序保持一致。

因此，final_factor_longshort.csv 及其对应的样本划分为后续因子轮动模型与回测分析提供了一个在时间顺序上严格一致、在信息使用上不存在穿越风险的数据基础。


# 第五部分：构建因子轮动预测模型

在完成因子多空收益序列与市场状态标签（Regime）的合并后，本研究使用 data/final_factor_longshort.csv 作为后续机器学习建模的唯一中心数据源。该数据集包含月度时间索引 month、十个目标因子（MOM20、MOM120、RSI、PB、PE、DIV、ROE、PROFIT_GR、VOL、BETA）的多空收益，以及对应月份的市场状态标签 regime。在进入建模阶段之前，代码首先将 month 转为时间类型并按时间升序排序，确保训练与预测严格遵循时间序列的先后顺序；随后对 regime 执行 one-hot 编码（pd.get_dummies），将离散状态映射为多个二值特征列 regime_*。最终输入特征集合 input_cols 明确由两部分组成：一是十个因子的历史多空收益（factor_cols），二是市场状态 one-hot 特征（regime_cols）。这一设定使得模型不仅可以学习“因子收益自身的时间依赖结构”，还可以显式利用“市场状态对因子溢价的状态依赖性影响”。

为了将原始按月的表格数据转化为 LSTM 可用的监督学习样本，本研究采用长度为 12 的滑动窗口构造时序输入（window = 12）。具体地，对于第 
𝑡
t 个月（从第 13 个月开始）形成一条训练样本：输入 
𝑋
𝑡
X
t
	​

 为过去 12 个月（
𝑡
−
12
t−12 至 
𝑡
−
1
t−1）的特征序列，每个时间步包含“10 个因子收益 + Regime one-hot”共 
𝑑
d 维特征；输出 
𝑦
𝑡
y
t
	​

 为第 
𝑡
t 个月的十个因子多空收益向量。对应到代码实现，X 的张量形状为 (样本数, 12, 特征数)，y 的形状为 (样本数, 10)。这一步的关键点在于：模型的预测目标是“下一期（当期）十个因子收益同时输出”，因此属于典型的多任务回归（multi-output regression），而不是为每个因子训练独立模型。该设置的理论动机是：不同因子收益之间可能存在共同的市场驱动或相关结构（例如宏观风险偏好变化同时影响动量与质量的溢价），联合建模可在小样本场景下提升统计效率并减少过拟合风险。

样本划分方面，代码采用严格的时间顺序切分方式，将全部监督样本按 7:2:1 划分为训练集、验证集和测试集：前 70% 样本用于模型参数学习（X_train, y_train），中间 20% 用于超参数与训练过程监控（X_val, y_val），最后 10% 用于最终的样本外评估与预测输出（X_test, y_test）。这种“按时间顺序的前推切分”可以避免金融时间序列建模中常见的数据泄漏问题：测试集中的任何月份都不会出现在训练或验证阶段的输入窗口中，模型在测试阶段仅能使用该月份之前的历史信息进行预测，符合真实交易环境下“用过去预测未来”的信息约束。结合你的实际实验设定，你的测试区间对应的月份为 2024-02-01 至 2024-12-01（这对应于你在外部流程中已确认的测试期时间范围），因此最终的权重生成与回测均以这一段样本外区间为核心检验窗口，确保结论来自样本外表现而非样本内拟合。

模型结构方面，本研究使用 Keras 的 Sequential 框架构建 LSTM 多任务回归网络：第一层为单层 LSTM（units=64，return_sequences=False），输入形状为 (12, 特征数)，用于将过去 12 个月的特征序列压缩成一个时序表示向量；随后加入 Dropout(0.2) 进行正则化以降低过拟合风险；再通过一个 Dense(32, activation="relu") 的非线性全连接层增强表达能力；最终输出层为 Dense(len(factor_cols))，即 10 维线性输出，对应十个因子的下一期收益预测值。训练目标函数采用均方误差（loss="mse"），优化器为 Adam（学习率 0.001），训练轮数为 80 epochs、批大小为 16，并在每一轮训练中同步监控验证集损失（validation_data=(X_val, y_val)）。模型训练完成后，代码在测试集上执行 model.predict(X_test) 得到样本外预测矩阵 y_pred，并通过索引对齐逻辑将预测结果与真实月份一一对应：由于第一个监督样本从第 13 行开始（window 的偏移），且测试集起点位于 val_end 之后，因此预测月份索引按照 start_idx = window + val_end 进行严格对齐，最终导出为 data/factor_prediction.csv，文件结构为 month + 10 个因子预测列（*_pred），用于后续的权重映射（softmax）与动态因子回测。



# 第六部分：从预测因子收益到因子权重（可执行的动态因子配置）

在第六部分中，模型对测试区间每个月输出一个长度为 10 的向量 (\hat{\mathbf{r}}*{t}=(\hat r*{t,1},\ldots,\hat r_{t,10}))，分别代表下一期（当期）十个因子的“预测多空收益”。但回测框架（天软 TSMultiFactor）需要的不是预测收益本身，而是**每期调仓时的因子配比**：即在当期应该给哪些因子更高的权重，形成一个可落地的多因子打分/组合。因此，本研究需要一个从“预测收益向量”到“因子权重向量” (\mathbf{w}_t) 的映射函数，使得权重满足两项核心约束：**非负**（便于解释、也便于在平台侧直接做线性组合）以及**归一化**（权重之和为 1，形成完整的因子暴露预算）。

## 6.1 权重映射的数学定义：Softmax 归一化

本研究采用 softmax 作为标准化映射，将预测因子收益转化为权重：
[
w_{t,i}=\frac{\exp(\hat r_{t,i}/\tau)}{\sum_{j=1}^{10}\exp(\hat r_{t,j}/\tau)} \quad,\quad i=1,\ldots,10
]
其中 (\tau>0) 为温度参数（temperature）。在你当前实现里可先取 (\tau=1)；如果未来希望权重更“尖锐”（更偏向少数因子），可减小 (\tau)；希望更“平滑”（更接近等权），可增大 (\tau)。该映射具备以下关键性质，直接对应回测需求：

1. **非负性**：(\exp(\cdot)) 恒为正，因此 (w_{t,i}>0)。
2. **归一化**：(\sum_i w_{t,i}=1)，表示每期把 100% 的因子配置预算分配到十个因子上。
3. **相对排序保持**：若 (\hat r_{t,a}>\hat r_{t,b})，则 (w_{t,a}>w_{t,b})。因此权重反映“模型认为谁更有优势”。
4. **对尺度敏感但可控**：通过 (\tau) 可以控制“预测差异”在权重层面的放大程度，避免过度集中带来的换手和不稳定。

从资产配置视角看，这一步可以理解为：模型先给出“每个因子下一期的期望收益信号”，softmax 再把这些信号转化为一组“相对偏好强度”，从而得到可执行的动态因子暴露。

## 6.2 工程实现与输出文件结构（用于回测对接）

在工程落地上，你的流程是：

1. **输入**：第六部分导出的 `data/factor_prediction.csv`，每一行是一月，包含 `month` 以及 10 个预测列（如 `MOM20_pred`、`PB_pred` 等）。
2. **逐月计算权重**：对每个月份 $t$ 的预测向量 $\hat{\mathbf{r}}_t$ 执行 softmax，得到 $\mathbf{w}_t$。
3. **输出**：保存为 `factor_weights_dynamic.csv`（或平台侧 json），格式建议为：

   * `month`：调仓月（统一为每月 01 号，与你的数据对齐规则一致）；
   * `MOM20_w, MOM120_w, ..., BETA_w`：对应十个因子的权重（0~1 之间，行内和为 1）。

该文件的语义是：**在 month 这一天调仓时，用这一行权重作为当期的因子组合配比**。在天软回测中，你会在 `GetFactors(EndT)` 中读取当前调仓日对应的权重行，并将因子库 `FFactorArr` 的“因子比例(%)”动态替换为当期权重（乘以 100 转为百分比），从而实现“每期不同因子配方”的动态多因子策略。

## 6.3 与“无数据穿插”的关系：权重完全来自样本外预测

这一部分需要强调信息约束：权重 (\mathbf{w}_t) 只依赖于模型在测试集对当期的预测 (\hat{\mathbf{r}}_t)，而预测的输入仅来自 (t) 之前的 12 个月历史窗口（以及对应历史月份的 regime one-hot），因此权重生成不使用任何未来信息。换言之，回测阶段每个月读取的权重，都是“在真实交易时点可以获得的信息”计算出来的，满足样本外评估的要求。

## 6.4 实务补充：权重可加入稳健约束（可写成扩展点）

为了使策略更贴近真实执行与风险控制，这一步未来可以自然扩展为“softmax + 约束”的版本，例如：

* **权重上限**：$w_{t,i}\le w_{\max}$，防止单因子暴露过度集中；
* **权重变化约束/换手控制**：对 $|\mathbf{w}_t-\mathbf{w}_{t-1}|$ 加惩罚，降低频繁切换；
* **风险预算化**：用预测收益/预测波动构造“收益风险比”再 softmax，使权重更偏向高性价比因子。

这些不改变主线逻辑：核心仍是“预测 → 映射为权重 → 回测验证”，但会让策略在评委视角更工程化、更可交易。


# 第七部分：动态因子策略回测

在回测阶段，本研究的核心目标并非单纯追求高收益，而是检验基于预测因子收益并通过 softmax 映射得到的动态因子权重，是否能够在风险可控的前提下，相较于更为简单或静态的配置方式，带来实质性的收益–风险改进。因此，回测设计中明确构建了多组具有清晰经济含义的对照策略。

首先，构建 等权多因子策略（Equal-weight Strategy） 作为最基础的基准。该策略在每个调仓期内对十个因子采用完全等权配置，即每个因子的权重固定为 10%，不随时间变化。该策略不包含任何状态判断或预测信息，其作用是作为“无轮动、无择时”的基准，用于衡量引入动态权重机制本身是否具备增量价值。

其次，构建 静态 Regime 因子策略（Regime-based Static Strategy） 作为规则驱动的中间对照。该策略仅利用市场状态（Regime）信息进行股票选择或因子暴露调整，而不使用因子收益预测模型。具体而言，该策略在不同 Regime 下采用预先设定的因子偏好或筛选规则（例如在某一 Regime 中偏向某类因子），但因子权重在该 Regime 内保持固定，不随时间连续变化。该策略用于检验：仅依赖市场状态信息，而不引入机器学习预测，是否已能获得显著改进。

最后，构建 动态因子权重策略（Dynamic Factor Rotation Strategy） 作为核心研究对象。该策略在测试区间内使用机器学习模型预测的下一期因子多空收益，通过 softmax 映射生成当期因子权重，并在每个调仓期动态调整因子配置。与前两类策略相比，该策略同时利用了因子历史收益的时间结构信息与市场状态信息，其权重在时间维度上连续变化，体现了真正意义上的因子轮动机制。

在评估维度上，回测不仅关注组合的绝对收益水平，还从多个层面对策略表现进行全面比较，包括：累计收益与年化收益率、相对于指数基准的超额收益、不同分组组合（如多空组合）的收益表现、策略换手率以及多项风险指标（如年化波动率、最大回撤和夏普比率）。通过这一系列指标的综合对比，可以系统性地评估动态因子权重映射在收益提升、风险控制及交易稳定性方面相对于等权策略和仅基于 Regime 的静态策略所带来的改进效果。


# 第八部分：动态因子策略回测结果

## 8.1 总体结论摘要（Executive Summary）

在统一回测口径下（以上证50为基准、月度调仓、同一测试区间 2024-02-01 至 2024-12-01、统一使用第5组作为组合表现代表），本研究比较了四类策略：等权多因子策略、基于规则的静态 Regime 策略、动态因子权重策略（不含 Regime）以及动态因子权重策略（含 Regime）。

实证结果显示，动态因子权重策略整体显著优于静态策略。其中，动态权重（无 Regime）与动态权重（有 Regime）的年化收益率（CAGR）分别为 40.09% 与 36.71%，明显高于等权策略的 21.24% 与规则策略的 23.13%。在风险调整后收益维度，动态权重（无 Regime）的 Sharpe Ratio 达到 1.38，动态权重（有 Regime）为 1.19，同样高于等权策略（1.03）与规则策略（0.78）。

更重要的是，动态权重策略的优势并非来源于简单放大风险暴露。动态权重（无 Regime）在 Sharpe（1.3806）与信息比率 IR（1.4792）两个维度上同时领先，表明其收益提升在单位总风险与单位跟踪误差意义下均更具效率。这一结果支持动态权重方法在组合层面改善收益–风险结构的有效性。

## 8.2 收益表现与样本期特征（Return Perspective）

从累计收益路径来看，四类策略在样本期内的收益提升并非均匀发生。动态权重策略（尤其是不含 Regime 的版本）在样本后段（约 2024-10 至 2024-11）出现明显的“台阶式跃迁”，抬升幅度显著高于静态策略。静态策略虽在相同阶段受益于整体风险偏好修复，但幅度明显较小。

在 CAGR 对比中，四类策略依次为：

动态权重（无 Regime）：40.09%

动态权重（有 Regime）：36.71%

规则策略：23.13%

等权策略：21.24%

需要强调的是，由于测试区间本身较短，年化收益率对尾部月份高度敏感。因此，本文在解释动态策略“显著更高 CAGR”时，并未单独依赖年化收益指标，而是结合后文的风险、回撤与超额收益稳定性指标进行交叉验证。

从月度收益分布与累计曲线形态综合判断，动态策略的相对优势更可能来源于少数关键月份的显著超额表现，而非每期均小幅占优。这一特征提示其收益来源具有阶段性，但并不削弱其组合层面有效性。

## 8.3 风险与风险调整后收益分析（Risk & Risk-adjusted）

在风险维度上，四类策略呈现出清晰分化。

年化波动率方面，等权策略最低（20.56%），规则策略最高（32.75%），动态权重（无 Regime）与动态权重（有 Regime）分别为 26.87% 与 29.77%，处于中间水平。

最大回撤与回撤持续期进一步揭示了策略差异。动态权重（无 Regime）的最大回撤仅为 -3.06%，且回撤持续期为 2 个月，为四类策略中最浅且修复最快；等权策略回撤为 -3.93%；动态权重（有 Regime）回撤加深至 -9.45%；规则策略回撤最深（-13.93%），且持续期长达 6 个月。

在风险调整后收益指标上，动态权重（无 Regime）在 Sharpe（1.3806）、Sortino（6.3496）与 Calmar（13.1028）三项指标上均显著领先，显示其在“收益—下行风险”权衡上最具优势。相比之下，动态权重（有 Regime）虽仍优于静态策略，但在风险控制与回撤深度方面明显弱于无 Regime 版本。

## 8.4 超额收益与相对基准表现（Relative Performance）

在相对基准维度，动态权重策略同样表现突出。动态权重（无 Regime）的年化超额收益为 0.2794，对应信息比率 IR 1.4792；动态权重（有 Regime）年化超额收益 0.2455，IR 1.2547。相比之下，等权策略与规则策略的 IR 分别为 1.0552 与 0.5554。

这一结果表明，动态权重（无 Regime）不仅实现了更高的超额收益，而且在单位跟踪误差意义下更为稳定，其优势并非来自更高的波动或更激进的市场暴露。

（五）因子层面有效性与结构性检验（重要的“反直觉”发现）

值得注意的是，在因子层面统计检验中，动态权重并未显著改善传统意义上的因子有效性指标。多空组合（Top–Bottom）收益在四类策略下均接近零或为负，IC 均值整体偏弱，区分度检验的 T-Stat 与 P-Value 未支持显著性。

这意味着：动态权重策略的优势并非来源于因子横截面预测能力在统计意义上的增强，而更可能来自组合层面权重调整机制对收益路径与风险暴露的工程性改良。这一发现对因子轮动策略的理解具有重要启示意义。

## 8.6 Regime 方法的审慎结论

在本样本期内，引入 Regime 信息并未带来稳定的边际改进。与无 Regime 的动态权重策略相比，含 Regime 版本在 CAGR、Sharpe 与 IR 上均有所下降，且回撤更深。这表明在当前样本分布与市场环境下，“Regime → 更优表现”的证据并不稳健。

需要强调的是，该结论并不否定 Regime 方法的潜在价值，而是指出：在样本期较短、状态转移次数有限的条件下，其复杂化带来的增量尚不足以稳定体现。Regime 方法是否能够在更长周期或更多极端状态下改善尾部风险，仍有待进一步研究。

## 8.7 综合评价

综合收益、风险、相对基准与可实施性指标，动态因子权重（无 Regime）在本研究样本内表现最优；动态权重（有 Regime）次之；等权策略在风险控制上更稳健但收益有限；规则策略整体性价比最低。

总体而言，本研究的核心贡献在于实证展示：即便在因子统计显著性并不强的环境下，基于机器学习预测的动态权重调整，仍可在组合层面显著改善收益–风险结构。



# 第九部分：总结与交付内容


本文围绕“因子轮动是否能够在样本外提升多因子投资组合的收益–风险表现”这一核心问题，构建了一套从因子构建、市场状态识别、机器学习预测到动态权重回测的完整研究框架，并在上证50成分股样本上进行了系统性的实证检验。研究结果表明，因子收益在时间维度上呈现出明显的阶段性与不稳定性，静态因子配置难以在不同市场环境下保持长期最优，而通过对因子收益进行预测并实施动态权重调整，能够在组合层面显著改善投资表现。

在回测结果中，基于机器学习预测的动态因子权重策略在样本外区间内显著优于等权多因子策略与仅依赖规则或 Regime 的静态配置策略。无论从绝对收益、风险调整后收益（Sharpe、Sortino、Calmar）还是相对于基准的超额收益效率（信息比率）来看，动态权重策略均表现出更高的综合性价比。尤其值得注意的是，动态权重策略的优势并非来源于单纯放大风险暴露：其年化波动率处于中等水平，最大回撤反而更浅且修复更快，显示该方法在收益路径与风险控制之间实现了更优的权衡。

在因子层面，本文的实证结果呈现出一个具有启示意义的“反直觉发现”：动态权重策略并未显著改善传统因子有效性检验指标，如 IC、多空收益或区分度统计。这表明，本研究中动态权重方法的主要贡献并不在于提升因子横截面预测在统计意义上的显著性，而更可能体现在组合构建层面，通过对因子暴露结构与时间路径的动态调整，提高了收益的稳定性与风险配置效率。这一发现提示，因子轮动策略的价值未必完全依赖于“更强的因子预测”，而可能更多来自权重调整机制本身对风险暴露与收益实现方式的优化。

关于市场状态（Regime）方法，本文采取了审慎而非预设结论的态度。在当前样本期内，引入 Regime 信息并未带来稳定的边际收益提升，反而在部分指标上弱于不含 Regime 的动态权重版本。这一结果并不否定 Regime 方法的理论合理性，而更可能反映了样本期较短、状态转移次数有限以及市场结构变化复杂等现实约束。在更长时间尺度或更丰富市场状态分布下，Regime 方法在尾部风险管理或极端情形中的潜在价值仍有待进一步检验。

综合而言，本文的研究结论支持这样一个核心观点：在因子收益具有显著时间变化特征的现实市场中，基于机器学习的动态因子权重配置，能够在样本外实现优于静态策略的收益–风险表现，即使在因子统计显著性并不强的环境下亦然。这一结论为因子轮动策略提供了实践层面的支持，也为未来研究在更长样本、更丰富状态变量以及交易成本约束下进一步探索因子配置方法，奠定了坚实的实证基础。


